<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JellyStream</title>

    <!-- Main Styles -->
    <link rel="stylesheet" href="css/main.css?v=15">

    <!-- Debug Logger - intercepts console.log and shows on screen -->
    <script>
    (function() {
        var debugEl;
        var logs = [];
        var origLog = console.log;
        var origError = console.error;

        function appendLog(msg, type) {
            logs.push('[' + type + '] ' + msg);
            if (logs.length > 50) logs.shift();
            if (!debugEl) debugEl = document.getElementById('debug-console');
            if (debugEl) {
                debugEl.innerHTML = logs.join('<br>');
                debugEl.scrollTop = debugEl.scrollHeight;
            }
        }

        console.log = function() {
            var msg = Array.prototype.slice.call(arguments).map(function(a) {
                return typeof a === 'object' ? JSON.stringify(a) : a;
            }).join(' ');
            appendLog(msg, 'LOG');
            origLog.apply(console, arguments);
        };

        console.error = function() {
            var msg = Array.prototype.slice.call(arguments).map(function(a) {
                return typeof a === 'object' ? JSON.stringify(a) : a;
            }).join(' ');
            appendLog(msg, 'ERR');
            origError.apply(console, arguments);
        };

        window.onerror = function(msg, url, line) {
            appendLog(msg + ' at ' + url + ':' + line, 'ERR');
        };
    })();
    </script>

    <!-- Core JavaScript - Load order matters! -->
    <!-- 1. State Management -->
    <script src="js/state-manager.js"></script>

    <!-- 2. API Clients -->
    <script src="js/api/jellyfin-client.js"></script>
    <script src="js/api/jellyseerr-client.js"></script>
    <script src="js/api/authentik-auth.js"></script>
    <script src="js/api/quick-connect.js"></script>

    <!-- 3. Core Systems -->
    <script src="js/lifecycle.js"></script>
    <script src="js/router.js"></script>

    <!-- 4. UI Utilities -->
    <script src="js/ui/focus-manager.js"></script>
    <script src="js/ui/modal-manager.js"></script>
    <!-- <script src="js/ui/notification-service.js"></script> -->

    <!-- 5. Screens (loaded from js/ instead of js/screens/ due to Tizen loading issue) -->
    <script src="js/splash-screen.js"></script>
    <script src="js/login-screen.js"></script>
    <script src="js/home-screen.js"></script>
    <script src="js/discover-screen.js"></script>
    <script src="js/library-screen.js"></script>
    <script src="js/search-screen.js"></script>
    <script src="js/settings-screen.js"></script>
    <script src="js/player-screen.js"></script>

    <!-- 6. Application Bootstrap - Must be last! -->
    <script src="js/main.js"></script>
</head>
<body>
    <!-- App Container -->
    <div id="app">

        <!-- Splash Screen -->
        <div id="splash-screen" class="screen active">
            <div class="splash-content">
                <img src="images/banner.jpg" alt="Streamy Tube" class="splash-banner">
                <div class="splash-loading">
                    <div class="spinner"></div>
                    <p class="splash-message">Loading...</p>
                </div>
                <!-- Debug console visible on screen -->
                <div id="debug-console" style="position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,0.9);color:#0f0;font-family:monospace;font-size:12px;padding:10px;max-height:200px;overflow-y:auto;z-index:99999;"></div>
            </div>
        </div>

        <!-- Login Screen -->
        <div id="login-screen" class="screen hidden">
            <div class="login-content">
                <img src="images/banner.jpg" alt="Streamy Tube" class="login-banner">
                <h1>Welcome to JellyStream</h1>

                <!-- Quick Connect Login (Primary) -->
                <div class="login-form" id="sso-login-form">
                    <h2>Sign In with Quick Connect</h2>
                    <p class="login-hint" style="margin-bottom: 20px;">Connect your TV to Jellyfin using your phone or computer.</p>

                    <button id="start-sso-btn" class="btn btn-primary btn-large" style="width: 100%; padding: 15px; font-size: 18px;">
                        Get Quick Connect Code
                    </button>

                    <p style="margin-top: 20px; color: #888; font-size: 14px; text-align: center;">
                        You'll approve the connection from your Jellyfin dashboard.
                    </p>

                    <hr style="margin: 30px 0; border: none; border-top: 1px solid #444;">

                    <details style="padding: 15px; background: #2a2a2a; border-radius: 8px;">
                        <summary style="cursor: pointer; font-weight: bold; color: #888;">Manual Login (Advanced)</summary>
                        <div style="margin-top: 15px;">
                            <div class="form-group">
                                <label for="jellyfin-server">Server URL</label>
                                <input type="text" id="jellyfin-server" placeholder="https://jellyfin.streamy.tube" value="https://jellyfin.streamy.tube" />
                            </div>
                            <div class="form-group">
                                <label for="jellyfin-access-token">Access Token</label>
                                <input type="password" id="jellyfin-access-token" placeholder="Paste your access token" style="font-family: monospace;" />
                            </div>
                            <div class="form-group">
                                <label for="jellyfin-user-id">User ID</label>
                                <input type="text" id="jellyfin-user-id" placeholder="Paste your user ID" style="font-family: monospace;" />
                            </div>
                            <button id="login-jellyfin-btn" class="btn btn-secondary">Connect Manually</button>
                        </div>
                    </details>
                </div>

                <!-- Quick Connect Code Display Panel -->
                <div class="login-form" id="device-code-panel" style="display: none;">
                    <h2>Quick Connect Code</h2>
                    <p style="margin-bottom: 20px;">On your phone or computer:</p>

                    <div style="background: #1a1a1a; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="margin-bottom: 10px; color: #ccc;">1. Go to your Jellyfin dashboard</p>
                        <div class="device-code-url" style="text-align: center; margin-bottom: 15px;">
                            <a href="https://jellyfin.streamy.tube" target="_blank" style="color: var(--color-primary); font-size: 18px; font-weight: bold; text-decoration: none;">
                                jellyfin.streamy.tube
                            </a>
                        </div>
                        <p style="margin-bottom: 5px; color: #ccc;">2. Log in with Authentik SSO</p>
                        <p style="color: #ccc;">3. Go to Settings > Quick Connect and enter:</p>
                    </div>

                    <div id="device-code-display" class="device-code" style="background: var(--color-primary); color: white; padding: 20px; border-radius: 8px; text-align: center; font-size: 48px; font-weight: bold; letter-spacing: 4px; font-family: monospace;">
                        ------
                    </div>

                    <p id="device-code-status" style="margin-top: 20px; text-align: center; color: #888;">
                        Waiting for approval...
                    </p>

                    <button id="cancel-device-code-btn" class="btn btn-secondary" style="margin-top: 20px; width: 100%;">Cancel</button>
                </div>

                <div class="login-form" id="jellyseerr-form" style="display: none;">
                    <h2>Connect to Jellyseerr</h2>
                    <div class="form-group">
                        <label for="jellyseerr-server">Jellyseerr Server URL</label>
                        <input type="text" id="jellyseerr-server" placeholder="http://192.168.1.100:5055" />
                    </div>
                    <div class="form-group">
                        <label for="jellyseerr-api-key">API Key</label>
                        <input type="text" id="jellyseerr-api-key" placeholder="API Key" />
                    </div>
                    <button id="login-jellyseerr-btn" class="btn btn-primary">Connect to Jellyseerr</button>
                </div>

                <div class="quick-connect-panel" id="quick-connect-panel" style="display: none;">
                    <h2>Quick Connect</h2>
                    <p>Enter this code on your Jellyfin dashboard:</p>
                    <div class="quick-connect-code" id="quick-connect-code">------</div>
                    <p class="quick-connect-status" id="quick-connect-status">Waiting for approval...</p>
                    <button id="cancel-quick-connect-btn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Home Screen -->
        <div id="home-screen" class="screen hidden">
            <div class="home-header">
                <h1>JellyStream</h1>
                <div class="user-info">
                    <span id="user-name">Loading...</span>
                </div>
            </div>

            <!-- Continue Watching Section -->
            <div class="content-section">
                <h2>Continue Watching</h2>
                <div class="content-row" id="continue-watching-row">
                    <div class="loading-placeholder">Loading your content...</div>
                </div>
            </div>

            <!-- Trending Section -->
            <div class="content-section">
                <h2>Trending Now</h2>
                <div class="content-row" id="trending-row">
                    <div class="loading-placeholder">Loading trending...</div>
                </div>
            </div>

            <!-- Recently Added Section -->
            <div class="content-section">
                <h2>Recently Added</h2>
                <div class="content-row" id="recently-added-row">
                    <div class="loading-placeholder">Loading new content...</div>
                </div>
            </div>
        </div>

        <!-- Discover Screen -->
        <div id="discover-screen" class="screen hidden">
            <div class="discover-container">
                <!-- Header -->
                <div class="discover-header">
                    <h1>Discover</h1>
                    <span id="discover-count" class="discover-count"></span>
                </div>

                <!-- Section Tabs (Movies / TV Shows) -->
                <div id="discover-sections" class="discover-sections">
                    <!-- Section tabs rendered by JS -->
                </div>

                <!-- Category Tabs -->
                <div id="discover-tabs" class="discover-tabs">
                    <!-- Category tabs rendered by JS -->
                </div>

                <!-- Content Area -->
                <div id="discover-content" class="discover-content">
                    <!-- Content Grid -->
                    <div id="discover-grid" class="discover-grid">
                        <!-- Cards rendered by JS -->
                    </div>

                    <!-- Loading Indicator -->
                    <div id="discover-loading" class="discover-loading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Loading...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Library Screen -->
        <div id="library-screen" class="screen hidden">
            <div class="library-header">
                <div class="library-tabs-row">
                    <div id="library-tabs" class="library-tabs">
                        <!-- Library tabs will be rendered here -->
                    </div>
                    <select id="library-sort" class="library-sort focusable">
                        <option value="SortName-Ascending">Name (A-Z)</option>
                        <option value="SortName-Descending">Name (Z-A)</option>
                        <option value="DateCreated-Descending">Date Added (Newest)</option>
                        <option value="DateCreated-Ascending">Date Added (Oldest)</option>
                        <option value="PremiereDate-Descending">Release Date (Newest)</option>
                        <option value="PremiereDate-Ascending">Release Date (Oldest)</option>
                        <option value="CommunityRating-Descending">Rating (Highest)</option>
                    </select>
                </div>
            </div>

            <div id="library-grid" class="library-grid">
                <!-- Media cards will be rendered here -->
            </div>

            <div id="library-loading" class="library-loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading...</p>
            </div>
        </div>

        <!-- Search Screen -->
        <div id="search-screen" class="screen hidden">
            <div class="search-container">
                <!-- Search Header -->
                <div class="search-header">
                    <h1>Search</h1>
                    <span id="search-results-count" class="search-results-count"></span>
                </div>

                <!-- Search Input Display -->
                <div class="search-input-container">
                    <div id="search-input-display" class="search-input-display focusable placeholder" tabindex="0">Type to search...</div>
                </div>

                <!-- Keyboard Modal -->
                <div id="keyboard-modal" class="keyboard-modal hidden">
                    <div class="keyboard-modal-backdrop"></div>
                    <div class="keyboard-modal-content">
                        <div class="keyboard-modal-header">
                            <div id="keyboard-input-display" class="keyboard-input-display">Type to search...</div>
                        </div>
                        <div id="search-keyboard" class="search-keyboard">
                            <!-- Keyboard keys will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Search Results -->
                <div id="search-results" class="search-results">
                    <p class="search-placeholder">Start typing to search your library</p>
                </div>

                <!-- Loading Indicator -->
                <div id="search-loading" class="search-loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Searching...</p>
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settings-screen" class="screen hidden">
            <div class="settings-container">
                <div class="settings-header">
                    <h1>Settings</h1>
                </div>

                <div class="settings-content">
                    <!-- Account Section -->
                    <div class="settings-section">
                        <h2 class="settings-section-title">Account</h2>
                        <div id="settings-account-info" class="settings-info">
                            <!-- Account info will be rendered here -->
                        </div>
                    </div>

                    <!-- Server Section -->
                    <div class="settings-section">
                        <h2 class="settings-section-title">Jellyfin Server</h2>
                        <div id="settings-server-info" class="settings-info">
                            <!-- Server info will be rendered here -->
                        </div>
                        <div class="settings-actions">
                            <button id="settings-switch-server-btn" class="settings-item focusable" tabindex="0">
                                <span class="settings-item-icon"><svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg></span>
                                <span class="settings-item-text">Switch Server</span>
                                <span class="settings-item-arrow">›</span>
                            </button>
                        </div>
                    </div>

                    <!-- Playback Settings Section -->
                    <div class="settings-section">
                        <h2 class="settings-section-title">Playback</h2>
                        <div id="settings-playback-info" class="settings-info">
                            <!-- Playback settings will be rendered here -->
                        </div>
                        <div class="settings-actions">
                            <button id="settings-playback-btn" class="settings-item focusable" tabindex="0">
                                <span class="settings-item-icon"><svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M8 5v14l11-7z"/></svg></span>
                                <span class="settings-item-text">Playback Settings</span>
                                <span class="settings-item-arrow">›</span>
                            </button>
                        </div>
                    </div>

                    <!-- Subtitles Settings Section -->
                    <div class="settings-section">
                        <h2 class="settings-section-title">Subtitles</h2>
                        <div id="settings-subtitles-info" class="settings-info">
                            <!-- Subtitle settings will be rendered here -->
                        </div>
                        <div class="settings-actions">
                            <button id="settings-subtitles-btn" class="settings-item focusable" tabindex="0">
                                <span class="settings-item-icon"><svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 7H9.5v-.5h-2v3h2V13H11v1c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1zm7 0h-1.5v-.5h-2v3h2V13H18v1c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1z"/></svg></span>
                                <span class="settings-item-text">Subtitle Settings</span>
                                <span class="settings-item-arrow">›</span>
                            </button>
                        </div>
                    </div>

                    <!-- Display Settings Section -->
                    <div class="settings-section">
                        <h2 class="settings-section-title">Display</h2>
                        <div id="settings-display-info" class="settings-info">
                            <!-- Display settings will be rendered here -->
                        </div>
                        <div class="settings-actions">
                            <button id="settings-display-btn" class="settings-item focusable" tabindex="0">
                                <span class="settings-item-icon"><svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/></svg></span>
                                <span class="settings-item-text">Display Settings</span>
                                <span class="settings-item-arrow">›</span>
                            </button>
                        </div>
                    </div>

                    <!-- Extensions/Plugins Section -->
                    <div class="settings-section">
                        <h2 class="settings-section-title">Extensions</h2>
                        <div id="settings-plugins-info" class="settings-info">
                            <!-- Plugins list will be rendered here -->
                        </div>
                        <div class="settings-actions">
                            <button id="settings-plugins-btn" class="settings-item focusable" tabindex="0">
                                <span class="settings-item-icon"><svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"/></svg></span>
                                <span class="settings-item-text">View All Plugins</span>
                                <span class="settings-item-arrow">›</span>
                            </button>
                        </div>
                    </div>

                    <!-- Jellyseerr Section -->
                    <div class="settings-section">
                        <h2 class="settings-section-title">Jellyseerr</h2>
                        <div id="settings-jellyseerr-info" class="settings-info">
                            <!-- Jellyseerr info will be rendered here -->
                        </div>
                        <div class="settings-actions">
                            <button id="settings-jellyseerr-btn" class="settings-item focusable" tabindex="0">
                                <span class="settings-item-icon"><svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg></span>
                                <span class="settings-item-text">Configure Jellyseerr</span>
                                <span class="settings-item-arrow">›</span>
                            </button>
                        </div>
                    </div>

                    <!-- Storage Section -->
                    <div class="settings-section">
                        <h2 class="settings-section-title">Storage</h2>
                        <div class="settings-actions">
                            <button id="settings-clear-cache-btn" class="settings-item focusable" tabindex="0">
                                <span class="settings-item-icon"><svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg></span>
                                <span class="settings-item-text">Clear Cache</span>
                                <span class="settings-item-arrow">›</span>
                            </button>
                        </div>
                    </div>

                    <!-- About Section -->
                    <div class="settings-section">
                        <h2 class="settings-section-title">About</h2>
                        <div id="settings-app-info" class="settings-info">
                            <!-- App info will be rendered here -->
                        </div>
                    </div>

                    <!-- Logout Section (at bottom) -->
                    <div class="settings-section settings-section-logout">
                        <div class="settings-actions">
                            <button id="settings-logout-btn" class="settings-item focusable settings-item-danger" tabindex="0">
                                <span class="settings-item-icon"><svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg></span>
                                <span class="settings-item-text">Log Out</span>
                                <span class="settings-item-arrow">›</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Player Screen -->
        <div id="player-screen" class="screen hidden">
            <div class="player-container">
                <video id="player-video" class="video-player"></video>

                <!-- Loading indicator -->
                <div id="player-loading" class="player-loading">
                    <div class="spinner"></div>
                    <p>Loading video...</p>
                </div>

                <!-- Player controls overlay -->
                <div class="player-controls visible">
                    <div class="controls-gradient"></div>

                    <!-- Progress bar row -->
                    <div class="progress-row">
                        <span id="current-time" class="time-display">0:00</span>
                        <div class="progress-container">
                            <div class="progress-track">
                                <div id="progress-bar" class="progress-bar"></div>
                                <div id="progress-thumb" class="progress-thumb"></div>
                            </div>
                        </div>
                        <span id="remaining-time" class="time-display">-0:00</span>
                    </div>

                    <!-- Controls row -->
                    <div class="controls-row">
                        <!-- Left controls -->
                        <div class="controls-left">
                            <button class="control-btn" id="rewind-btn" title="Rewind 10s">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/>
                                </svg>
                            </button>
                            <button class="control-btn" id="play-pause-btn" title="Play/Pause">
                                <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M8 5v14l11-7z"/>
                                </svg>
                                <svg class="pause-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display:none">
                                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                                </svg>
                            </button>
                            <button class="control-btn" id="forward-btn" title="Forward 10s">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/>
                                </svg>
                            </button>

                            <!-- Info items -->
                            <span id="progress-percent" class="control-info">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1z"/></svg>
                                <span>0%</span>
                            </span>
                            <span id="media-rating" class="control-info">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="#FFD700"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                <span>0.0</span>
                            </span>
                            <span id="ends-at" class="control-info control-info-text">Ends at --:--</span>
                        </div>

                        <!-- Right controls -->
                        <div class="controls-right">
                            <button class="control-btn" id="favorite-btn" title="Add to Favorites">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"/>
                                </svg>
                            </button>
                            <button class="control-btn" id="tracks-btn" title="Audio & Subtitles">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H5V6h14v12zM7 15h3v2H7zm0-4h3v2H7zm0-4h10v2H7zm5 4h5v2h-5zm0 4h5v2h-5z"/>
                                </svg>
                            </button>
                            <div class="volume-control">
                                <button class="control-btn" id="volume-btn" title="Volume">
                                    <svg class="volume-on" width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                                    </svg>
                                    <svg class="volume-muted" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="display:none">
                                        <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
                                    </svg>
                                </button>
                                <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="100">
                            </div>
                            <button class="control-btn" id="settings-btn" title="Settings">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                                </svg>
                            </button>
                            <button class="control-btn" id="fullscreen-btn" title="Fullscreen">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Settings menu popup -->
                <div id="player-settings-menu" class="player-settings-menu hidden">
                    <div class="settings-menu-item focusable" data-setting="aspect">
                        <span class="settings-menu-label">Aspect Ratio</span>
                        <span class="settings-menu-value" id="aspect-value">Auto</span>
                    </div>
                    <div class="settings-menu-item focusable" data-setting="speed">
                        <span class="settings-menu-label">Playback Speed</span>
                        <span class="settings-menu-value" id="speed-value">1x</span>
                    </div>
                    <div class="settings-menu-item focusable" data-setting="quality">
                        <span class="settings-menu-label">Quality</span>
                        <span class="settings-menu-value" id="quality-value">Auto</span>
                    </div>
                    <div class="settings-menu-item focusable" data-setting="repeat">
                        <span class="settings-menu-label">Repeat Mode</span>
                        <span class="settings-menu-value" id="repeat-value">None</span>
                    </div>
                    <div class="settings-menu-item focusable" data-setting="info">
                        <span class="settings-menu-label">Playback Info</span>
                        <span class="settings-menu-value"></span>
                    </div>
                </div>

                <!-- Seek indicator -->
                <div id="seek-indicator" class="seek-indicator"></div>
            </div>
        </div>

    </div>

    <!-- Navigation Bar -->
        <nav id="nav-bar" class="nav-bar" style="display: none;">
            <button class="nav-item focusable active" data-screen="home">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </span>
                <span class="nav-label">Home</span>
            </button>
            <button class="nav-item focusable" data-screen="discover">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon>
                    </svg>
                </span>
                <span class="nav-label">Discover</span>
            </button>
            <button class="nav-item focusable" data-screen="library">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                        <polyline points="17 2 12 7 7 2"></polyline>
                    </svg>
                </span>
                <span class="nav-label">Library</span>
            </button>
            <button class="nav-item focusable" data-screen="search">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </span>
                <span class="nav-label">Search</span>
            </button>
            <button class="nav-item focusable" data-screen="settings">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </span>
                <span class="nav-label">Settings</span>
            </button>
        </nav>

    <!-- Global Loading Indicator -->
    <div id="loading-indicator" class="loading-indicator hidden">
        <div class="spinner"></div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>
</body>
</html>
